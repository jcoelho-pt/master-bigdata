<!DOCTYPE html>
<!-- saved from url=(0037)https://cdn.imf.com/c/c7274/6/2..html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="databricks-html-version" content="1">
<title>2. Introducción a Spark Streaming - Scala - Databricks</title>


<meta name="google" content="notranslate">
<meta name="robots" content="nofollow">
<meta http-equiv="Content-Language" content="en">


<link rel="stylesheet" type="text/css" href="./2. Introducción a Spark Streaming - Scala - Databricks_files/main.css">
<link rel="stylesheet" href="./2. Introducción a Spark Streaming - Scala - Databricks_files/print.css" media="print">
<link rel="icon" type="image/png" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/cb3b82e952bbd1cb294e8bbd45fc0d7fdb8c929bf8eeb3ebc3c0da139cba96c9/img/favicon.ico">
<script>window.settings = {"enableNotebookNotifications":true,"enableSshKeyUI":false,"defaultInteractivePricePerDBU":0.4,"enableClusterMetricsUI":true,"enableOnDemandClusterType":true,"enableAutoCompleteAsYouType":[],"devTierName":"Community Edition","enableJobsPrefetching":true,"workspaceFeaturedLinks":[{"linkURI":"https://docs.databricks.com/index.html","displayName":"Documentation","icon":"question"},{"linkURI":"https://docs.databricks.com/release-notes/product/index.html","displayName":"Release Notes","icon":"code"},{"linkURI":"https://docs.databricks.com/spark/latest/training/index.html","displayName":"Training & Tutorials","icon":"graduation-cap"}],"enableReservoirTableUI":false,"enableClearStateFeature":true,"dbcForumURL":"http://forums.databricks.com/","enableProtoClusterInfoDeltaPublisher":true,"enableAttachExistingCluster":true,"resetJobListOnConnect":true,"serverlessDefaultSparkVersion":"latest-stable-scala2.11","maxCustomTags":45,"serverlessDefaultMaxWorkers":20,"enableInstanceProfilesUIInJobs":true,"nodeInfo":{"node_types":[{"support_ssh":false,"spark_heap_memory":4800,"instance_type_id":"r3.2xlarge","spark_core_oversubscription_factor":8.0,"node_type_id":"dev-tier-node","description":"Community Optimized","support_cluster_tags":false,"container_memory_mb":6000,"node_instance_type":{"instance_type_id":"r3.2xlarge","provider":"AWS","local_disk_size_gb":160,"compute_units":26.0,"number_of_ips":14,"local_disks":1,"reserved_compute_units":3.64,"gpus":0,"memory_mb":62464,"num_cores":8,"local_disk_type":"AHCI","max_attachable_disks":0,"supported_disk_types":[{"ebs_volume_type":"GENERAL_PURPOSE_SSD"},{"ebs_volume_type":"THROUGHPUT_OPTIMIZED_HDD"}],"reserved_memory_mb":4800},"memory_mb":6144,"is_hidden":false,"category":"Community Edition","num_cores":0.88,"support_port_forwarding":false,"support_ebs_volumes":false,"is_deprecated":false}],"default_node_type_id":"dev-tier-node"},"sqlAclsDisabledMap":{"spark.databricks.acl.enabled":"false","spark.databricks.acl.sqlOnly":"false"},"enableDatabaseSupportClusterChoice":true,"enableClusterAcls":true,"notebookRevisionVisibilityHorizon":999999,"serverlessClusterProductName":"Serverless Pool","showS3TableImportOption":true,"maxEbsVolumesPerInstance":10,"isAdmin":true,"deltaProcessingBatchSize":1000,"timerUpdateQueueLength":100,"sqlAclsEnabledMap":{"spark.databricks.acl.enabled":"true","spark.databricks.acl.sqlOnly":"true"},"enableLargeResultDownload":true,"maxElasticDiskCapacityGB":5000,"serverlessDefaultMinWorkers":2,"zoneInfos":[{"id":"us-west-2c","isDefault":true},{"id":"us-west-2b","isDefault":false},{"id":"us-west-2a","isDefault":false}],"enableCustomSpotPricingUIByTier":false,"serverlessClustersEnabled":false,"enableFindAndReplace":true,"disallowUrlImportExceptFromDocs":false,"defaultStandardClusterModel":{"cluster_name":"","node_type_id":"dev-tier-node","spark_version":"3.5.x-scala2.11","num_workers":0,"aws_attributes":{"first_on_demand":0,"availability":"ON_DEMAND","zone_id":"us-west-2c","spot_bid_price_percent":100},"autotermination_minutes":120,"default_tags":{"Vendor":"Databricks","Creator":"jrodriguez@opensistemas.com","ClusterName":null,"ClusterId":"<Generated after creation>"}},"enableEBSVolumesUIForJobs":true,"enablePublishNotebooks":true,"enableBitbucketCloud":true,"createTableInNotebookS3Link":{"url":"https://docs.databricks.com/_static/notebooks/data-import/s3.html","displayName":"S3","workspaceFileName":"S3 Example"},"sanitizeHtmlResult":true,"enableJobAclsConfig":false,"enableFullTextSearch":false,"enableElasticSparkUI":false,"enableNewClustersCreate":true,"clusters":true,"allowRunOnPendingClusters":true,"useAutoscalingByDefault":false,"enableAzureToolbar":false,"fileStoreBase":"FileStore","enableEmailInAzure":false,"enableRLibraries":true,"enableTableAclsConfig":false,"enableSshKeyUIInJobs":true,"enableDetachAndAttachSubMenu":true,"configurableSparkOptionsSpec":[{"keyPattern":"spark\\.kryo(\\.[^\\.]+)+","valuePattern":".*","keyPatternDisplay":"spark.kryo.*","valuePatternDisplay":"*","description":"Configuration options for Kryo serialization"},{"keyPattern":"spark\\.io\\.compression\\.codec","valuePattern":"(lzf|snappy|org\\.apache\\.spark\\.io\\.LZFCompressionCodec|org\\.apache\\.spark\\.io\\.SnappyCompressionCodec)","keyPatternDisplay":"spark.io.compression.codec","valuePatternDisplay":"snappy|lzf","description":"The codec used to compress internal data such as RDD partitions, broadcast variables and shuffle outputs."},{"keyPattern":"spark\\.serializer","valuePattern":"(org\\.apache\\.spark\\.serializer\\.JavaSerializer|org\\.apache\\.spark\\.serializer\\.KryoSerializer)","keyPatternDisplay":"spark.serializer","valuePatternDisplay":"org.apache.spark.serializer.JavaSerializer|org.apache.spark.serializer.KryoSerializer","description":"Class to use for serializing objects that will be sent over the network or need to be cached in serialized form."},{"keyPattern":"spark\\.rdd\\.compress","valuePattern":"(true|false)","keyPatternDisplay":"spark.rdd.compress","valuePatternDisplay":"true|false","description":"Whether to compress serialized RDD partitions (e.g. for StorageLevel.MEMORY_ONLY_SER). Can save substantial space at the cost of some extra CPU time."},{"keyPattern":"spark\\.speculation","valuePattern":"(true|false)","keyPatternDisplay":"spark.speculation","valuePatternDisplay":"true|false","description":"Whether to use speculation (recommended off for streaming)"},{"keyPattern":"spark\\.es(\\.[^\\.]+)+","valuePattern":".*","keyPatternDisplay":"spark.es.*","valuePatternDisplay":"*","description":"Configuration options for ElasticSearch"},{"keyPattern":"es(\\.([^\\.]+))+","valuePattern":".*","keyPatternDisplay":"es.*","valuePatternDisplay":"*","description":"Configuration options for ElasticSearch"},{"keyPattern":"spark\\.(storage|shuffle)\\.memoryFraction","valuePattern":"0?\\.0*([1-9])([0-9])*","keyPatternDisplay":"spark.(storage|shuffle).memoryFraction","valuePatternDisplay":"(0.0,1.0)","description":"Fraction of Java heap to use for Spark's shuffle or storage"},{"keyPattern":"spark\\.streaming\\.backpressure\\.enabled","valuePattern":"(true|false)","keyPatternDisplay":"spark.streaming.backpressure.enabled","valuePatternDisplay":"true|false","description":"Enables or disables Spark Streaming's internal backpressure mechanism (since 1.5). This enables the Spark Streaming to control the receiving rate based on the current batch scheduling delays and processing times so that the system receives only as fast as the system can process. Internally, this dynamically sets the maximum receiving rate of receivers. This rate is upper bounded by the values `spark.streaming.receiver.maxRate` and `spark.streaming.kafka.maxRatePerPartition` if they are set."},{"keyPattern":"spark\\.streaming\\.receiver\\.maxRate","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.receiver.maxRate","valuePatternDisplay":"numeric","description":"Maximum rate (number of records per second) at which each receiver will receive data. Effectively, each stream will consume at most this number of records per second. Setting this configuration to 0 or a negative number will put no limit on the rate. See the deployment guide in the Spark Streaming programing guide for mode details."},{"keyPattern":"spark\\.streaming\\.kafka\\.maxRatePerPartition","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.kafka.maxRatePerPartition","valuePatternDisplay":"numeric","description":"Maximum rate (number of records per second) at which data will be read from each Kafka partition when using the Kafka direct stream API introduced in Spark 1.3. See the Kafka Integration guide for more details."},{"keyPattern":"spark\\.streaming\\.kafka\\.maxRetries","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.kafka.maxRetries","valuePatternDisplay":"numeric","description":"Maximum number of consecutive retries the driver will make in order to find the latest offsets on the leader of each partition (a default value of 1 means that the driver will make a maximum of 2 attempts). Only applies to the Kafka direct stream API introduced in Spark 1.3."},{"keyPattern":"spark\\.streaming\\.ui\\.retainedBatches","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.ui.retainedBatches","valuePatternDisplay":"numeric","description":"How many batches the Spark Streaming UI and status APIs remember before garbage collecting."}],"enableReactNotebookComments":true,"enableAdminPasswordReset":false,"checkBeforeAddingAadUser":false,"enableResetPassword":true,"maxClusterTagValueLength":255,"enableJobsSparkUpgrade":true,"createTableInNotebookDBFSLink":{"url":"https://docs.databricks.com/_static/notebooks/data-import/dbfs.html","displayName":"DBFS","workspaceFileName":"DBFS Example"},"perClusterAutoterminationEnabled":false,"enableNotebookCommandNumbers":true,"allowStyleInSanitizedHtml":true,"sparkVersions":[{"key":"1.6.3-db2-hadoop2-scala2.10","displayName":"Spark 1.6.3-db2 (Hadoop 2, Scala 2.10)","packageLabel":"spark-image-aba860a0ffce4f3471fb14aefdcb1d768ac66a53a5ad884c48745ef98aeb9d67","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"3.3.x-gpu-scala2.11","displayName":"3.3 (includes Apache Spark 2.2.0, GPU, Scala 2.11)","packageLabel":"spark-image-280a8d41cd338f5b48d43eb87622c542c6e6584c430f6d3afe8f3401b9607cb9","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"2.1.1-db5-scala2.11","displayName":"Spark 2.1.1-db5 (Scala 2.11)","packageLabel":"spark-image-08d9fc1551087e0876236f19640c4a83116b1649f15137427d21c9056656e80e","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"1.6.x-ubuntu15.10","displayName":"Spark 1.6.x (Hadoop 1)","packageLabel":"spark-image-8cea23fb9094e174bf5815d79009f4a8e383eb86cf2909cf6c6434ed8da2a16a","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"3.3.x-scala2.10","displayName":"3.3 (includes Apache Spark 2.2.0, Scala 2.10)","packageLabel":"spark-image-dd410c68e21c3c563ad6128d35705b605d70530124d55aff1dd12d7e15adfa20","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"1.4.x-ubuntu15.10","displayName":"Spark 1.4.1 (Hadoop 1, deprecated)","packageLabel":"spark-image-f710650fb8aaade8e4e812368ea87c45cd8cd0b5e6894ca6c94f3354e8daa6dc","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"2.2.x-scala2.11","displayName":"3.0 (includes Apache Spark 2.2.0, Scala 2.11)","packageLabel":"spark-image-67ab3a06d1e83d5b60df7063245eb419a2e9fe329aeeb7e7d9713332c669bb17","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"2.1.1-db6-scala2.10","displayName":"Spark 2.1.1-db6 (Scala 2.10)","packageLabel":"spark-image-177f3f02a6a3432d30068332dc857b9161345bdd2ee8a2d2de05bb05cb4b0f4c","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"2.1.0-db2-scala2.11","displayName":"Spark 2.1.0-db2 (Scala 2.11)","packageLabel":"spark-image-267c4490a3ab8a39acdbbd9f1d36f6decdecebf013e30dd677faff50f1d9cf8b","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"4.0.x-scala2.11","displayName":"4.0 beta (Scala 2.11)","packageLabel":"spark-image-9e6200ba78f9f23c62827bf44cfc8cbdbf67ac0ddf3f7d6ce5d06222a95eb83f","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION","SUPPORTS_TABLE_ACLS"]},{"key":"2.1.x-gpu-scala2.11","displayName":"Spark 2.1 (Auto-updating, GPU, Scala 2.11 experimental)","packageLabel":"spark-image-d613235f93e0f29838beb2079a958c02a192ed67a502192bc67a8a5f2fb37f35","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"2.0.0-ubuntu15.10-scala2.10","displayName":"Spark 2.0.0 (Scala 2.10)","packageLabel":"spark-image-073c1b52ace74f251fae2680624a0d8d184a8b57096d1c21c5ce56c29be6a37a","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"latest-stable-gpu-scala2.11","displayName":"Latest stable (3.5, GPU, Scala 2.11)","packageLabel":"spark-image-150ea14c3136dac53b46f721799aac3d93e75d91e4035aa535220bea607510c2","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"3.4.x-scala2.11","displayName":"3.4 (includes Apache Spark 2.2.0, Scala 2.11)","packageLabel":"spark-image-a5615cb1adf0d2305f2b93188c6720174ec3e782d100fcbfa96ff870392861df","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"2.0.2-db3-scala2.10","displayName":"Spark 2.0.2-db3 (Scala 2.10)","packageLabel":"spark-image-584091dedb690de20e8cf22d9e02fdcce1281edda99eedb441a418d50e28088f","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"3.2.x-scala2.10","displayName":"3.2 (includes Apache Spark 2.2.0, Scala 2.10)","packageLabel":"spark-image-557788bea0eea16bbf7a8ba13ace07e64dd7fc86270bd5cea086097fe886431f","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"latest-experimental-scala2.10","displayName":"Latest experimental (Scala 2.10)","packageLabel":"spark-image-ec81b6840af02ee2321dd8dfe2587437bbcddf024d4ae287f326a98fac406a6c","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"4.0.x-gpu-scala2.11","displayName":"4.0 beta (GPU, Scala 2.11)","packageLabel":"spark-image-7503e77db609bdfe00e4af109abf62764bc2a61bf3f9b2bcec4f979f8633e8c0","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"2.1.0-db1-scala2.11","displayName":"Spark 2.1.0-db1 (Scala 2.11)","packageLabel":"spark-image-e8ad5b72cf0f899dcf2b4720c1f572ab0e87a311d6113b943b4e1d4a7edb77eb","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"2.1.1-db4-scala2.11","displayName":"Spark 2.1.1-db4 (Scala 2.11)","packageLabel":"spark-image-52bca0ca866e3f4243d3820a783abf3b9b3b553edf234abef14b892657ceaca9","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"latest-rc-scala2.11","displayName":"Latest RC (4.0, Scala 2.11)","packageLabel":"spark-image-9e6200ba78f9f23c62827bf44cfc8cbdbf67ac0ddf3f7d6ce5d06222a95eb83f","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION","SUPPORTS_TABLE_ACLS"]},{"key":"latest-stable-scala2.11","displayName":"Latest stable (3.5, Scala 2.11)","packageLabel":"spark-image-edea2f4129c468cb4b9642796b9933911d5e3723e9a97553ff5b0fbb7121d114","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION","SUPPORTS_TABLE_ACLS"]},{"key":"2.1.0-db2-scala2.10","displayName":"Spark 2.1.0-db2 (Scala 2.10)","packageLabel":"spark-image-a2ca4f6b58c95f78dca91b1340305ab3fe32673bd894da2fa8e1dc8a9f8d0478","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"1.6.x-ubuntu15.10-hadoop1","displayName":"Spark 1.6.x (Hadoop 1)","packageLabel":"spark-image-8cea23fb9094e174bf5815d79009f4a8e383eb86cf2909cf6c6434ed8da2a16a","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"2.0.2-db4-scala2.11","displayName":"Spark 2.0.2-db4 (Scala 2.11)","packageLabel":"spark-image-7dbc7583e8271765b8a1508cb9e832768e35489bbde2c4c790bc6766aee2fd7f","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"1.6.1-ubuntu15.10-hadoop1","displayName":"Spark 1.6.1 (Hadoop 1)","packageLabel":"spark-image-21d1cac181b7b8856dd1b4214a3a734f95b5289089349db9d9c926cb87d843db","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"2.0.x-gpu-scala2.11","displayName":"Spark 2.0 (Auto-updating, GPU, Scala 2.11 experimental)","packageLabel":"spark-image-968b89f1d0ec32e1ee4dacd04838cae25ef44370a441224177a37980d539d83a","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"1.6.2-ubuntu15.10-hadoop1","displayName":"Spark 1.6.2 (Hadoop 1)","packageLabel":"spark-image-8cea23fb9094e174bf5815d79009f4a8e383eb86cf2909cf6c6434ed8da2a16a","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"next-major-version-scala2.11","displayName":"Next major version (4.0 snapshot, Scala 2.11)","packageLabel":"spark-image-9d142ed498de5b446479343bd871fa03022fb06e63bfa9e0e96ef18ab8a27a6f","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION","SUPPORTS_TABLE_ACLS"]},{"key":"1.6.3-db1-hadoop2-scala2.10","displayName":"Spark 1.6.3-db1 (Hadoop 2, Scala 2.10)","packageLabel":"spark-image-eaa8d9b990015a14e032fb2e2e15be0b8d5af9627cd01d855df728b67969d5d9","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"1.6.3-db2-hadoop1-scala2.10","displayName":"Spark 1.6.3-db2 (Hadoop 1, Scala 2.10)","packageLabel":"spark-image-14112ea0645bea94333a571a150819ce85573cf5541167d905b7e6588645cf3b","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"3.5.x-scala2.10","displayName":"3.5 LTS (includes Apache Spark 2.2.1, Scala 2.10)","packageLabel":"spark-image-38fb6f623fbe4e652be9d58083e85e6982c9b79b5052e71d534b6e3ac267a355","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION","SUPPORTS_TABLE_ACLS"]},{"key":"1.6.2-ubuntu15.10-hadoop2","displayName":"Spark 1.6.2 (Hadoop 2)","packageLabel":"spark-image-161245e66d887cd775e23286a54bab0b146143e1289f25bd1732beac454a1561","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"1.6.1-ubuntu15.10-hadoop2","displayName":"Spark 1.6.1 (Hadoop 2)","packageLabel":"spark-image-4cafdf8bc6cba8edad12f441e3b3f0a8ea27da35c896bc8290e16b41fd15496a","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"2.0.2-db2-scala2.10","displayName":"Spark 2.0.2-db2 (Scala 2.10)","packageLabel":"spark-image-36d48f22cca7a907538e07df71847dd22aaf84a852c2eeea2dcefe24c681602f","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"2.0.x-ubuntu15.10-scala2.11","displayName":"Spark 2.0 (Ubuntu 15.10, Scala 2.11, deprecated)","packageLabel":"spark-image-8e1c50d626a52eac5a6c8129e09ae206ba9890f4523775f77af4ad6d99a64c44","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"2.0.x-scala2.10","displayName":"Spark 2.0 (Auto-updating, Scala 2.10)","packageLabel":"spark-image-859e88079f97f58d50e25163b39a1943d1eeac0b6939c5a65faba986477e311a","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"2.1.1-db4-scala2.10","displayName":"Spark 2.1.1-db4 (Scala 2.10)","packageLabel":"spark-image-c7c0224de396cd1563addc1ae4bca6ba823780b6babe6c3729ddf73008f29ba4","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"latest-rc-scala2.10","displayName":"Latest RC (Scala 2.10)","packageLabel":"spark-image-ec81b6840af02ee2321dd8dfe2587437bbcddf024d4ae287f326a98fac406a6c","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"latest-stable-scala2.10","displayName":"Latest stable (3.5, Scala 2.10)","packageLabel":"spark-image-38fb6f623fbe4e652be9d58083e85e6982c9b79b5052e71d534b6e3ac267a355","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION","SUPPORTS_TABLE_ACLS"]},{"key":"2.0.2-db1-scala2.11","displayName":"Spark 2.0.2-db1 (Scala 2.11)","packageLabel":"spark-image-c2d623f03dd44097493c01aa54a941fc31978ebe6d759b36c75b716b2ff6ab9c","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"2.0.2-db4-scala2.10","displayName":"Spark 2.0.2-db4 (Scala 2.10)","packageLabel":"spark-image-859e88079f97f58d50e25163b39a1943d1eeac0b6939c5a65faba986477e311a","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"2.1.1-db5-scala2.10","displayName":"Spark 2.1.1-db5 (Scala 2.10)","packageLabel":"spark-image-74133df2c13950431298d1cab3e865c191d83ac33648a8590495c52fc644c654","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"3.4.x-gpu-scala2.11","displayName":"3.4 (includes Apache Spark 2.2.0, GPU, Scala 2.11)","packageLabel":"spark-image-613a129fcaa93423a4de06407c9f93e341ed5c6b02d69179d2703c8bb47e2b99","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"1.5.x-ubuntu15.10","displayName":"Spark 1.5.2 (Hadoop 1, deprecated)","packageLabel":"spark-image-c9d2a8abf41f157a4acc6d52bc721090346f6fea2de356f3a66e388f54481698","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"latest-experimental-gpu-scala2.11","displayName":"Latest experimental (4.1 snapshot, GPU, Scala 2.11)","packageLabel":"spark-image-df20f0c8a9bfbb3f35f74374e5a95b85fb285acbb204d535f6b2b02d6e4b32ad","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"2.2.x-scala2.10","displayName":"3.0 (includes Apache Spark 2.2.0, Scala 2.10)","packageLabel":"spark-image-d549f2d4a523994ecdf37e531b51d5ec7d8be51534bb0ca5322eaad28ba8f557","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"3.0.x-scala2.11","displayName":"3.0 (includes Apache Spark 2.2.0, Scala 2.11)","packageLabel":"spark-image-67ab3a06d1e83d5b60df7063245eb419a2e9fe329aeeb7e7d9713332c669bb17","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"2.0.x-scala2.11","displayName":"Spark 2.0 (Auto-updating, Scala 2.11)","packageLabel":"spark-image-7dbc7583e8271765b8a1508cb9e832768e35489bbde2c4c790bc6766aee2fd7f","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"2.1.x-scala2.10","displayName":"Spark 2.1 (Auto-updating, Scala 2.10)","packageLabel":"spark-image-177f3f02a6a3432d30068332dc857b9161345bdd2ee8a2d2de05bb05cb4b0f4c","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"3.1.x-scala2.11","displayName":"3.1 (includes Apache Spark 2.2.0, Scala 2.11)","packageLabel":"spark-image-241fa8b78ee6343242b1756b18076270894385ff40a81172a6fb5eadf66155d3","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"2.1.0-db3-scala2.10","displayName":"Spark 2.1.0-db3 (Scala 2.10)","packageLabel":"spark-image-25a17d070af155f10c4232dcc6248e36a2eb48c24f8d4fc00f34041b86bd1626","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"2.0.2-db2-scala2.11","displayName":"Spark 2.0.2-db2 (Scala 2.11)","packageLabel":"spark-image-4fa852ba378e97815083b96c9cada7b962a513ec23554a5fc849f7f1dd8c065a","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"3.1.x-scala2.10","displayName":"3.1 (includes Apache Spark 2.2.0, Scala 2.10)","packageLabel":"spark-image-7efac6b9a8f2da59cb4f6d0caac46cfcb3f1ebf64c8073498c42d0360f846714","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"3.3.x-scala2.11","displayName":"3.3 (includes Apache Spark 2.2.0, Scala 2.11)","packageLabel":"spark-image-73a161da0570b3f51c8eb238602af2f5561789ea80b25c69a48691fc84e2d974","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"next-major-version-gpu-scala2.11","displayName":"Next major version (4.0 snapshot, GPU, Scala 2.11)","packageLabel":"spark-image-5f96cb5bca2e499fe51aaf6063d37d57a255177d9b24ab07b1b4ac55d90571cc","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"3.5.x-gpu-scala2.11","displayName":"3.5 LTS (includes Apache Spark 2.2.1, GPU, Scala 2.11)","packageLabel":"spark-image-150ea14c3136dac53b46f721799aac3d93e75d91e4035aa535220bea607510c2","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"1.3.x-ubuntu15.10","displayName":"Spark 1.3.0 (Hadoop 1, deprecated)","packageLabel":"spark-image-40d2842670bc3dc178b14042501847d76171437ccf70613fa397a7a24c48b912","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"2.0.1-db1-scala2.11","displayName":"Spark 2.0.1-db1 (Scala 2.11)","packageLabel":"spark-image-10ab19f634bbfdb860446c326a9f76dc25bfa87de6403b980566279142a289ea","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"2.0.2-db3-scala2.11","displayName":"Spark 2.0.2-db3 (Scala 2.11)","packageLabel":"spark-image-7fd7aaa89d55692e429115ae7eac3b1a1dc4de705d50510995f34306b39c2397","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"2.1.1-db6-scala2.11","displayName":"Spark 2.1.1-db6 (Scala 2.11)","packageLabel":"spark-image-fdad9ef557700d7a8b6bde86feccbcc3c71d1acdc838b0fd299bd19956b1076e","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"1.6.3-db1-hadoop1-scala2.10","displayName":"Spark 1.6.3-db1 (Hadoop 1, Scala 2.10)","packageLabel":"spark-image-d50af1032799546b8ccbeeb76889a20c819ebc2a0e68ea20920cb30d3895d3ae","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"2.0.2-db1-scala2.10","displayName":"Spark 2.0.2-db1 (Scala 2.10)","packageLabel":"spark-image-654bdd6e9bad70079491987d853b4b7abf3b736fff099701501acaabe0e75c41","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"2.0.x-ubuntu15.10","displayName":"Spark 2.0 (Ubuntu 15.10, Scala 2.10, deprecated)","packageLabel":"spark-image-a659f3909d51b38d297b20532fc807ecf708cfb7440ce9b090c406ab0c1e4b7e","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"3.5.x-scala2.11","displayName":"3.5 LTS (includes Apache Spark 2.2.1, Scala 2.11)","packageLabel":"spark-image-edea2f4129c468cb4b9642796b9933911d5e3723e9a97553ff5b0fbb7121d114","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION","SUPPORTS_TABLE_ACLS"]},{"key":"latest-experimental-scala2.11","displayName":"Latest experimental (4.1 snapshot, Scala 2.11)","packageLabel":"spark-image-5c3995fea4f6e7b8cbb9c534480ccc5cf2378f6d701c676c20ecafad6c91c65d","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION","SUPPORTS_TABLE_ACLS"]},{"key":"3.2.x-scala2.11","displayName":"3.2 (includes Apache Spark 2.2.0, Scala 2.11)","packageLabel":"spark-image-5537926238bc55cb6cd76ee0f0789511349abead3781c4780721a845f34b5d4e","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"2.0.1-db1-scala2.10","displayName":"Spark 2.0.1-db1 (Scala 2.10)","packageLabel":"spark-image-5a13c2db3091986a4e7363006cc185c5b1108c7761ef5d0218506cf2e6643840","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"2.1.x-scala2.11","displayName":"Spark 2.1 (Auto-updating, Scala 2.11)","packageLabel":"spark-image-fdad9ef557700d7a8b6bde86feccbcc3c71d1acdc838b0fd299bd19956b1076e","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"2.1.0-db1-scala2.10","displayName":"Spark 2.1.0-db1 (Scala 2.10)","packageLabel":"spark-image-f0ab82a5deb7908e0d159e9af066ba05fb56e1edb35bdad41b7ad2fd62a9b546","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"3.0.x-scala2.10","displayName":"3.0 (includes Apache Spark 2.2.0, Scala 2.10)","packageLabel":"spark-image-d549f2d4a523994ecdf37e531b51d5ec7d8be51534bb0ca5322eaad28ba8f557","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"1.6.0-ubuntu15.10","displayName":"Spark 1.6.0 (Hadoop 1)","packageLabel":"spark-image-10ef758029b8c7e19cd7f4fb52fff9180d75db92ca071bd94c47f3c1171a7cb5","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"1.6.x-ubuntu15.10-hadoop2","displayName":"Spark 1.6.x (Hadoop 2)","packageLabel":"spark-image-161245e66d887cd775e23286a54bab0b146143e1289f25bd1732beac454a1561","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"2.0.0-ubuntu15.10-scala2.11","displayName":"Spark 2.0.0 (Scala 2.11)","packageLabel":"spark-image-b4ec141e751f201399f8358a82efee202560f7ed05e1a04a2ae8778f6324b909","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"2.1.0-db3-scala2.11","displayName":"Spark 2.1.0-db3 (Scala 2.11)","packageLabel":"spark-image-ccbc6b73f158e2001fc1fb8c827bfdde425d8bd6d65cb7b3269784c28bb72c16","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"latest-rc-gpu-scala2.11","displayName":"Latest RC (4.0 GPU, Scala 2.11)","packageLabel":"spark-image-7503e77db609bdfe00e4af109abf62764bc2a61bf3f9b2bcec4f979f8633e8c0","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"3.4.x-scala2.10","displayName":"3.4 (includes Apache Spark 2.2.0, Scala 2.10)","packageLabel":"spark-image-b768d65de82a89fbfabff8ec1d2f279ced527c0ec05e83c3ae0c206d2e97edc0","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]}],"enablePresentationMode":false,"enableClearStateAndRunAll":true,"enableTableAclsByTier":false,"enableRestrictedClusterCreation":true,"enableFeedback":true,"enableClusterAutoScaling":false,"enableUserVisibleDefaultTags":true,"defaultNumWorkers":0,"serverContinuationTimeoutMillis":10000,"jobsUnreachableThresholdMillis":60000,"driverStderrFilePrefix":"stderr","enableNotebookRefresh":false,"createTableInNotebookImportedFileLink":{"url":"https://docs.databricks.com/_static/notebooks/data-import/imported-file.html","displayName":"Imported File","workspaceFileName":"Imported File Example"},"accountsOwnerUrl":"https://accounts.cloud.databricks.com/registration.html#login","tableAclsDisabledMap":{"spark.databricks.acl.dfAclsEnabled":"false"},"driverStdoutFilePrefix":"stdout","showDbuPricing":true,"databricksDocsBaseHostname":"docs.databricks.com","defaultNodeTypeToPricingUnitsMap":{"r3.2xlarge":2,"i3.4xlarge":4,"class-node":1,"m4.2xlarge":1.5,"r4.xlarge":1,"m4.4xlarge":3,"Standard_DS5_v2":3,"Standard_D2s_v3":0.5,"Standard_DS14":4,"r4.16xlarge":16,"Standard_DS11":0.5,"p2.8xlarge":16,"m4.10xlarge":8,"Standard_D8s_v3":1.5,"Standard_E32s_v3":8,"Standard_DS3":0.75,"Standard_DS2_v2":0.5,"r3.8xlarge":8,"r4.4xlarge":4,"dev-tier-node":1,"Standard_L8s":2,"Standard_E4s_v3":1,"Standard_D3_v2":0.75,"Standard_DS15_v2":8,"Standard_D16s_v3":3,"Standard_D5_v2":3,"Standard_E8s_v3":2,"c3.8xlarge":4,"Standard_E2s_v3":0.5,"Standard_DS3_v2":0.75,"r3.4xlarge":4,"Standard_DS4":1.5,"i2.4xlarge":6,"m4.xlarge":0.75,"r4.8xlarge":8,"Standard_H16":4,"Standard_DS14_v2":4,"r4.large":0.5,"Standard_DS12":1,"development-node":1,"i2.2xlarge":3,"g2.8xlarge":6,"i3.large":0.75,"memory-optimized":1,"m4.large":0.4,"Standard_F4s":0.5,"p2.16xlarge":24,"i3.8xlarge":8,"i3.16xlarge":16,"Standard_DS12_v2":1,"Standard_L32s":8,"Standard_D4s_v3":0.75,"Standard_DS13":2,"Standard_DS11_v2":0.5,"Standard_DS13_v2":2,"c3.2xlarge":1,"Standard_L4s":1,"Standard_F16s":2,"c4.2xlarge":1,"Standard_L16s":4,"i2.xlarge":1.5,"Standard_DS2":0.5,"compute-optimized":1,"c4.4xlarge":2,"Standard_D2_v2":0.5,"i3.2xlarge":2,"Standard_E16s_v3":4,"Standard_F8s":1,"c3.4xlarge":2,"g2.2xlarge":1.5,"p2.xlarge":2,"m4.16xlarge":12,"Standard_DS4_v2":1.5,"c4.8xlarge":4,"i3.xlarge":1,"r3.xlarge":1,"r4.2xlarge":2,"i2.8xlarge":12},"tableFilesBaseFolder":"/tables","enableSparkDocsSearch":true,"sparkHistoryServerEnabled":true,"enableEBSVolumesUI":false,"homePageWelcomeMessage":"Welcome to ","metastoreServiceRowLimit":1000000,"enableIPythonImportExport":true,"enableClusterTagsUIForJobs":true,"enableClusterTagsUI":false,"enableNotebookHistoryDiffing":true,"branch":"2.63.904","accountsLimit":3,"enableSparkEnvironmentVariables":true,"enableX509Authentication":false,"useAADLogin":false,"enableStructuredStreamingNbOptimizations":true,"enableNotebookGitBranching":true,"local":false,"enableNotebookLazyRenderWrapper":false,"enableClusterAutoScalingForJobs":true,"enableStrongPassword":false,"showReleaseNote":true,"displayDefaultContainerMemoryGB":6,"broadenedEditPermission":false,"enableNotebookCommandMode":true,"disableS3TableImport":false,"deploymentMode":"production","useSpotForWorkers":true,"removePasswordInAccountSettings":false,"preferStartTerminatedCluster":false,"enableUserInviteWorkflow":true,"createTableConnectorOptionLinks":[{"url":"https://docs.databricks.com/_static/notebooks/redshift.html","displayName":"Amazon Redshift","workspaceFileName":"Amazon Redshift Example"},{"url":"https://docs.databricks.com/_static/notebooks/structured-streaming-kinesis.html","displayName":"Amazon Kinesis","workspaceFileName":"Amazon Kinesis Example"},{"url":"https://docs.databricks.com/_static/notebooks/data-import/jdbc.html","displayName":"JDBC","workspaceFileName":"JDBC Example"},{"url":"https://docs.databricks.com/_static/notebooks/cassandra.html","displayName":"Cassandra","workspaceFileName":"Cassandra Example"},{"url":"https://docs.databricks.com/_static/notebooks/structured-streaming-etl-kafka.html","displayName":"Kafka","workspaceFileName":"Kafka Example"},{"url":"https://docs.databricks.com/_static/notebooks/redis.html","displayName":"Redis","workspaceFileName":"Redis Example"},{"url":"https://docs.databricks.com/_static/notebooks/elasticsearch.html","displayName":"Elasticsearch","workspaceFileName":"Elasticsearch Example"}],"enableStaticNotebooks":true,"sandboxForUrlSandboxFrame":"allow-scripts allow-popups allow-popups-to-escape-sandbox allow-forms","enableCssTransitions":true,"serverlessEnableElasticDisk":true,"minClusterTagKeyLength":1,"showHomepageFeaturedLinks":true,"pricingURL":"https://databricks.com/product/pricing","enableClusterEdit":true,"enableClusterAclsConfig":false,"useTempS3UrlForTableUpload":false,"notifyLastLogin":false,"enableSshKeyUIByTier":false,"enableCreateClusterOnAttach":true,"defaultAutomatedPricePerDBU":0.2,"enableNotebookGitVersioning":true,"defaultMinWorkers":2,"files":"files/","feedbackEmail":"feedback@databricks.com","enableDriverLogsUI":true,"defaultMaxWorkers":8,"enableWorkspaceAclsConfig":false,"serverlessRunPythonAsLowPrivilegeUser":false,"dropzoneMaxFileSize":2047,"enableNewClustersList":true,"enableNewDashboardViews":true,"enableJobListPermissionFilter":false,"driverLog4jFilePrefix":"log4j","enableSingleSignOn":true,"enableMavenLibraries":true,"displayRowLimit":1000,"deltaProcessingAsyncEnabled":true,"enableSparkEnvironmentVariablesUI":false,"defaultSparkVersion":{"key":"3.5.x-scala2.11","displayName":"3.5 LTS (includes Apache Spark 2.2.1, Scala 2.11)","packageLabel":"spark-image-edea2f4129c468cb4b9642796b9933911d5e3723e9a97553ff5b0fbb7121d114","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION","SUPPORTS_TABLE_ACLS"]},"deprecatedEnableStructuredDataAcls":false,"enableCustomSpotPricing":false,"enableMountAclsConfig":false,"defaultAutoterminationMin":120,"useDevTierHomePage":true,"disableExportNotebook":false,"enableClusterClone":true,"enableNotebookLineNumbers":true,"enablePublishHub":false,"notebookHubUrl":"http://hub.dev.databricks.com/","showSqlEndpoints":false,"enableNotebookDatasetInfoView":true,"defaultTagKeys":{"CLUSTER_NAME":"ClusterName","VENDOR":"Vendor","CLUSTER_TYPE":"ResourceClass","CREATOR":"Creator","CLUSTER_ID":"ClusterId"},"enableClusterAclsByTier":false,"databricksDocsBaseUrl":"https://docs.databricks.com/","azurePortalLink":"https://portal.azure.com","cloud":"AWS","customSparkVersionPrefix":"custom:","disallowAddingAdmins":true,"enableSparkConfUI":true,"featureTier":"DEVELOPER_BASIC_TIER","mavenCentralSearchEndpoint":"http://search.maven.org/solrsearch/select","defaultServerlessClusterModel":{"cluster_name":"","node_type_id":"i3.2xlarge","spark_version":"latest-stable-scala2.11","num_workers":null,"enable_jdbc_auto_start":true,"custom_tags":{"ResourceClass":"Serverless"},"autoscale":{"min_workers":2,"max_workers":20},"spark_conf":{"spark.databricks.cluster.profile":"serverless","spark.databricks.repl.allowedLanguages":"sql,python","spark.databricks.acl.enabled":"false","spark.databricks.acl.sqlOnly":"false"},"aws_attributes":{"ebs_volume_count":null,"availability":"ON_DEMAND","first_on_demand":1,"ebs_volume_type":null,"spot_bid_price_percent":100,"zone_id":"us-west-2c","ebs_volume_size":null},"autotermination_minutes":0,"enable_elastic_disk":false,"default_tags":{"Vendor":"Databricks","Creator":"jrodriguez@opensistemas.com","ClusterName":null,"ClusterId":"<Generated after creation>"}},"enableOrgSwitcherUI":true,"bitbucketCloudBaseApiV2Url":"https://api.bitbucket.org/2.0","clustersLimit":1,"enableJdbcImport":true,"enableElasticDisk":false,"logfiles":"logfiles/","enableRelativeNotebookLinks":true,"enableMultiSelect":true,"homePageLogo":"login/databricks_logoTM_rgb_TM.svg","enableWebappSharding":true,"enableNotebookParamsEdit":true,"enableClusterDeltaUpdates":true,"enableSingleSignOnLogin":false,"separateTableForJobClusters":true,"ebsVolumeSizeLimitGB":{"GENERAL_PURPOSE_SSD":[100,4096],"THROUGHPUT_OPTIMIZED_HDD":[500,4096]},"enableMountAcls":false,"requireEmailUserName":true,"dbcFeedbackURL":"mailto:feedback@databricks.com","enableMountAclService":true,"enableSingleSignOnByTierForOrg":false,"showVersion":true,"serverlessClustersByDefault":false,"enableWorkspaceAcls":false,"maxClusterTagKeyLength":127,"gitHash":"","clusterTagReservedPrefixes":[],"tableAclsEnabledMap":{"spark.databricks.acl.dfAclsEnabled":"true"},"showWorkspaceFeaturedLinks":true,"signupUrl":"https://databricks.com/try-databricks","databricksDocsNotebookPathPrefix":"^https://docs\\.databricks\\.com/_static/notebooks/.+$","serverlessAttachEbsVolumesByDefault":false,"enableTokensConfig":false,"allowFeedbackForumAccess":true,"enableImportFromUrl":true,"allowDisplayHtmlByUrl":true,"enableTokens":false,"enableMiniClusters":true,"enableNewJobList":true,"enableDebugUI":false,"enableStreamingMetricsDashboard":true,"allowNonAdminUsers":true,"enableJobsRetryOnTimeout":true,"loginLogo":"/login/databricks_logoTM_rgb_TM.svg","useStandardTierUpgradeTooltips":true,"staticNotebookResourceUrl":"https://databricks-prod-cloudfront.cloud.databricks.com/static/cb3b82e952bbd1cb294e8bbd45fc0d7fdb8c929bf8eeb3ebc3c0da139cba96c9/","enableSpotClusterType":true,"enableSparkPackages":true,"checkAadUserInWorkspaceTenant":false,"dynamicSparkVersions":true,"useIframeForHtmlResult":false,"enableClusterTagsUIByTier":false,"enableNotebookHistoryUI":true,"addWhitespaceAfterLastNotebookCell":true,"enableClusterLoggingUI":true,"enableDatabaseDropdownInTableUI":true,"showDebugCounters":false,"enableInstanceProfilesUI":false,"enableFolderHtmlExport":true,"homepageFeaturedLinks":[{"linkURI":"https://docs.databricks.com/_static/notebooks/gentle-introduction-to-apache-spark.html","displayName":"Introduction to Apache Spark on Databricks","icon":"img/home/Python_icon.svg"},{"linkURI":"https://docs.databricks.com/_static/notebooks/databricks-for-data-scientists.html","displayName":"Databricks for Data Scientists","icon":"img/home/Scala_icon.svg"},{"linkURI":"https://docs.databricks.com/_static/notebooks/structured-streaming-python.html","displayName":"Introduction to Structured Streaming","icon":"img/home/Python_icon.svg"}],"enableClusterStart":false,"maxImportFileVersion":5,"enableEBSVolumesUIByTier":false,"singleSignOnComingSoon":false,"enableTableAclService":false,"removeSubCommandCodeWhenExport":true,"upgradeURL":"https://accounts.cloud.databricks.com/registration.html#login","maxAutoterminationMinutes":10000,"showResultsFromExternalSearchEngine":true,"autoterminateClustersByDefault":true,"notebookLoadingBackground":"#fff","sshContainerForwardedPort":2200,"enableServerAutoComplete":true,"enableStaticHtmlImport":true,"enableInstanceProfilesByTier":false,"showForgotPasswordLink":true,"defaultMemoryPerContainerMB":6000,"enablePresenceUI":true,"minAutoterminationMinutes":10,"accounts":true,"useOnDemandClustersByDefault":true,"useFramedStaticNotebooks":false,"enableNewProgressReportUI":true,"enableAutoCreateUserUI":true,"defaultCoresPerContainer":4,"showTerminationReason":true,"enableNewClustersGet":true,"showPricePerDBU":false,"showSqlProxyUI":true,"enableNotebookErrorHighlighting":true};</script>
<script>var __DATABRICKS_NOTEBOOK_MODEL = {"version":"NotebookV1","origId":531573771711854,"name":"2. Introducción a Spark Streaming - Scala","language":"scala","commands":[{"version":"CommandV1","origId":531573771711855,"guid":"ac78a179-e7e4-4f1c-9e9a-68129c1cb70e","subtype":"command","commandType":"auto","position":2.0,"command":"%md ## **Parseando líneas del log**\n\nEn este ejemplo se añade la capacidad de parsear líneas del log. Se muestra un ejemplo de procesamiento en el que se cuenta el número de bytes servidos por el Apache en cada microbatch.\n\nNOTA: No debería fallar la ejecución pero si el notebook da errores de serialización al modificarlo conviene usar la opción \"Detach & Re-attach\" en el cluster activo, es la opción que está accesible desde el menú de control de este notebook (arriba a la izquierda).","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1516550331590,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":null,"diffDeletes":null,"globalVars":{},"latestUser":"a user","commandTitle":null,"showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"06cc0556-c58f-4cfd-aab0-0c8d9cba77d7"},{"version":"CommandV1","origId":531573771711857,"guid":"341dd64d-100b-454c-b339-02f927cfa92c","subtype":"command","commandType":"auto","position":4.0,"command":"// === Control de flujo de la aplicación ===\nval stopActiveContext = true\t \n// \"true\"  = parar los StreamingContext que ya se estén ejecutando (mejor dejarlo así);       \n// \"false\" = no parar y dejarlos seguir ejecutándose, pero puede ocurrir que los cambios que hagáis en el código no se ejecuten.\n\n// === Configuraciones para Spark Streaming ===\nval batchIntervalSeconds = 1 \nval eventsPerSecond = 10    // Para el generador en memoria de logs, cuántas líneas de log se generarán por segundo.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1516550331701,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":null,"diffDeletes":null,"globalVars":{},"latestUser":"a user","commandTitle":null,"showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"562e4ea4-16a2-4061-a91e-55286bfdbbb6"},{"version":"CommandV1","origId":531573771711859,"guid":"4eaa161f-5e16-495b-bab4-ae9851d7ee58","subtype":"command","commandType":"auto","position":6.0,"command":"import org.apache.spark._\nimport org.apache.spark.storage._\nimport org.apache.spark.streaming._\n\nimport org.apache.spark.serializer.{KryoSerializer}\nimport org.apache.spark.serializer.{KryoSerializer, KryoRegistrator}\n\nimport org.apache.spark.sql._\nimport org.apache.spark.rdd._","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1516550331808,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":null,"diffDeletes":null,"globalVars":{},"latestUser":"a user","commandTitle":null,"showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e2ad9813-1ae6-472b-a116-5df54c1c3040"},{"version":"CommandV1","origId":531573771711861,"guid":"cce8c265-80d1-47c2-812c-fddbe93eb6d7","subtype":"command","commandType":"auto","position":8.0,"command":"// Este es un Receiver implementado ad hoc para tener una fuente de datos en stream. Se trata de un \"generador aleatorio\" de logs de acceso web.\n// No es relevante entender qué se está haciendo aquí. En el material lectivo comentaremos los Receivers.\n\nimport scala.util.Random\nimport org.apache.spark.streaming.receiver._\n\nclass DummySource(ratePerSec: Int) extends Receiver[String](StorageLevel.MEMORY_AND_DISK_2) {\n  \n  val logs = List(\n\"109.169.248.247 - - [12/Dec/2015:18:25:11 +0100] \\\"GET /administrator/ HTTP/1.1\\\" 200 4263 \\\"-\\\" \\\"Mozilla/5.0 (Windows NT 6.0; rv:34.0) Gecko/20100101 Firefox/34.0\\\" \\\"-\\\"\",\n\"109.169.248.247 - - [12/Dec/2015:18:25:11 +0100] \\\"POST /administrator/index.php HTTP/1.1\\\" 200 4494 \\\"http://almhuette-raith.at/administrator/\\\" \\\"Mozilla/5.0 (Windows NT 6.0; rv:34.0) Gecko/20100101 Firefox/34.0\\\" \\\"-\\\"\",\n\"188.45.108.168 - - [12/Dec/2015:19:44:06 +0100] \\\"GET / HTTP/1.1\\\" 200 10479 \\\"http://www.almenland.at/almhuetten-mit-naechtigung.html\\\" \\\"Mozilla/5.0 (Linux; Android 4.4.2; de-at; SAMSUNG GT-I9301I Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/1.5 Chrome/28.0.1500.94 Mobile Safari/537.36\\\" \\\"-\\\"\",\n\"188.45.108.168 - - [12/Dec/2015:19:44:06 +0100] \\\"GET /modules/mod_bowslideshow/tmpl/css/bowslideshow.css HTTP/1.1\\\" 200 1725 \\\"http://www.almhuette-raith.at/\\\" \\\"Mozilla/5.0 (Linux; Android 4.4.2; de-at; SAMSUNG GT-I9301I Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/1.5 Chrome/28.0.1500.94 Mobile Safari/537.36\\\" \\\"-\\\"\",\n\"188.45.108.168 - - [12/Dec/2015:19:44:06 +0100] \\\"GET /templates/_system/css/general.css HTTP/1.1\\\" 404 239 \\\"http://www.almhuette-raith.at/\\\" \\\"Mozilla/5.0 (Linux; Android 4.4.2; de-at; SAMSUNG GT-I9301I Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/1.5 Chrome/28.0.1500.94 Mobile Safari/537.36\\\" \\\"-\\\"\",\n\"188.45.108.168 - - [12/Dec/2015:19:44:07 +0100] \\\"GET /templates/jp_hotel/css/template.css HTTP/1.1\\\" 200 10004 \\\"http://www.almhuette-raith.at/\\\" \\\"Mozilla/5.0 (Linux; Android 4.4.2; de-at; SAMSUNG GT-I9301I Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/1.5 Chrome/28.0.1500.94 Mobile Safari/537.36\\\" \\\"-\\\"\",\n\"188.45.108.168 - - [12/Dec/2015:19:44:07 +0100] \\\"GET /templates/jp_hotel/css/layout.css HTTP/1.1\\\" 200 1801 \\\"http://www.almhuette-raith.at/\\\" \\\"Mozilla/5.0 (Linux; Android 4.4.2; de-at; SAMSUNG GT-I9301I Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/1.5 Chrome/28.0.1500.94 Mobile Safari/537.36\\\" \\\"-\\\"\",\n\"188.45.108.168 - - [12/Dec/2015:19:44:07 +0100] \\\"GET /templates/jp_hotel/css/menu.css HTTP/1.1\\\" 200 1457 \\\"http://www.almhuette-raith.at/\\\" \\\"Mozilla/5.0 (Linux; Android 4.4.2; de-at; SAMSUNG GT-I9301I Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/1.5 Chrome/28.0.1500.94 Mobile Safari/537.36\\\" \\\"-\\\"\",\n\"188.45.108.168 - - [12/Dec/2015:19:44:07 +0100] \\\"GET /templates/jp_hotel/css/suckerfish.css HTTP/1.1\\\" 200 3465 \\\"http://www.almhuette-raith.at/\\\" \\\"Mozilla/5.0 (Linux; Android 4.4.2; de-at; SAMSUNG GT-I9301I Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/1.5 Chrome/28.0.1500.94 Mobile Safari/537.36\\\" \\\"-\\\"\",\n\"188.45.108.168 - - [12/Dec/2015:19:44:08 +0100] \\\"GET /media/system/js/caption.js HTTP/1.1\\\" 200 1963 \\\"http://www.almhuette-raith.at/\\\" \\\"Mozilla/5.0 (Linux; Android 4.4.2; de-at; SAMSUNG GT-I9301I Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/1.5 Chrome/28.0.1500.94 Mobile Safari/537.36\\\" \\\"-\\\"\",\n\"66.249.69.97 - - [12/Dec/2015:19:44:08 +0100] \\\"GET /071300/242153 HTTP/1.1\\\" 404 514 \\\"-\\\" \\\"Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\\\" \\\"-\\\"\",\n\"188.45.108.168 - - [12/Dec/2015:19:44:09 +0100] \\\"GET /nf HTTP/1.1\\\" 404 505 \\\"-\\\" \\\"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2062.94 Safari/537.36\\\" \\\"-\\\"\",\n\"188.45.108.168 - - [12/Dec/2015:19:44:09 +0100] \\\"GET /plain.php HTTP/1.1\\\" 500 505 \\\"-\\\" \\\"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2062.94 Safari/537.36\\\" \\\"-\\\"\")\n\n  def onStart() {\n    new Thread(\"Logs Dummy Source\") {\n      override def run() { receive() }\n    }.start()\n  }\n\n  def onStop() {\n  }\n\n  private def receive() {\n    while(!isStopped()) {      \n      store(logs(Random.nextInt(logs.size)))\n      Thread.sleep((1000.toDouble / ratePerSec).toInt)\n    }\n  }\n}\n\n\ncase class LogRecord( clientIp: String, clientIdentity: String, user: String, dateTime: String, request:String,statusCode:Int, bytesSent:Long, referer:String, userAgent:String )\n \nobject Logs {\n    val PATTERN = \"\"\"^(\\S+) (\\S+) (\\S+) \\[([\\w:/]+\\s[+\\-]\\d{4})\\] \"(\\S+) (\\S+) (\\S+)\" (\\d{3}) (\\S+) \"(\\S+)\" \"([^\"]*)\"\"\"\".r\n \n    def parseLogLine(log: String): LogRecord = {\n      try {\n        val res = PATTERN.findFirstMatchIn(log)\n \n        if (res.isEmpty) {\n          println(\"Rejected Log Line: \" + log)\n          LogRecord(\"Empty\", \"-\", \"-\", \"\", \"\",  -1, -1, \"-\", \"-\" )\n        }\n        else {\n          val m = res.get\n          // NOTE:   HEAD does not have a content size.\n          if (m.group(9).equals(\"-\")) {\n            LogRecord(m.group(1), m.group(2), m.group(3), m.group(4),\n              m.group(5), m.group(8).toInt, 0, m.group(10), m.group(11))\n          }\n          else {\n            LogRecord(m.group(1), m.group(2), m.group(3), m.group(4),\n              m.group(5), m.group(8).toInt, m.group(9).toLong, m.group(10), m.group(11))\n          }\n        }\n      } catch {\n        case e: Exception =>\n          println(\"Exception on line:\" + log + \":\" + e.getMessage);\n          LogRecord(\"Empty\", \"-\", \"-\", \"\", \"-\", -1, -1, \"-\", \"-\" )\n      }\n    }\n }  \n","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1516550331914,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":null,"diffDeletes":null,"globalVars":{},"latestUser":"a user","commandTitle":null,"showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a5640e49-ff9d-4a29-a865-5a5e41e18303"},{"version":"CommandV1","origId":531573771711862,"guid":"c0c36d9b-3ea8-4a66-ab1a-075d17f218cd","subtype":"command","commandType":"auto","position":9.0,"command":"var newContextCreated = false      // Flag para detectar si se ha creado un nuevo contexto o no\n\n// Función de creación y configuración de un nuevo StreamingContext\ndef creatingFunc(): StreamingContext = {\n  \n  val ssc = new StreamingContext(sc, Seconds(batchIntervalSeconds))\n  val lines = ssc.receiverStream(new DummySource(eventsPerSecond))\n  val accessLogs = lines.map(Logs.parseLogLine)\n\n  val contentSizes = accessLogs.map(log => log.bytesSent)\n  val contentTotal = contentSizes.reduce(_ + _)\n \n  contentTotal.print() // Contenido total en bytes servido por el Apache\n  \n  println(\"Se ha invocado la función para crear un nuevo StreamingContext\")\n  newContextCreated = true  \n  ssc\n}","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1516550332023,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":null,"diffDeletes":null,"globalVars":{},"latestUser":"a user","commandTitle":null,"showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"328283eb-322c-4b8e-a8e3-9d51749423a2"},{"version":"CommandV1","origId":531573771711864,"guid":"b14e311b-2f14-45c6-8a81-b2026da8ee45","subtype":"command","commandType":"auto","position":11.0,"command":"if (stopActiveContext) {\n  // Paramos cualquier StreamingContext activo \n  StreamingContext.getActive.foreach { _.stop(stopSparkContext = false) }\n} \n\n// Obtenemos o creamos el StreamingContext con el que trabajar\nval ssc = StreamingContext.getActiveOrCreate(creatingFunc)\nif (newContextCreated) {\n  println(\"Nuevo contexto creado desde la función creatingFunc\") \n} else {\n  println(\"Hay un contexto ejecutándose o se ha recuperado de un checkpoint\")\n}\n\nssc.start()\nssc.awaitTerminationOrTimeout(batchIntervalSeconds * 20 * 1000) // Esto pondrá esta celda del notebook en espera durante 20 veces el batchIntervalSeconds.\n","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1516550332125,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":null,"diffDeletes":null,"globalVars":{},"latestUser":"a user","commandTitle":null,"showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"214e4b8a-9838-4443-8dc2-ab432c9e43b9"},{"version":"CommandV1","origId":531573771711867,"guid":"059ece16-b714-4b15-982d-1654ca97f9df","subtype":"command","commandType":"auto","position":15.0,"command":"//StreamingContext.getActive.foreach { _.stop(stopSparkContext = false) }","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1516550332239,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"156a8c95-ebc3-46d2-983f-1ff7d93c5948"}],"dashboards":[],"guid":"eaf9a654-470f-4242-9627-cc15bfaad899","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}};</script>
<script src="./2. Introducción a Spark Streaming - Scala - Databricks_files/notebook-main.js.download" onerror="window.mainJsLoadError = true;"></script>
</head>
<body><div id="static-notebook" data-reactid=".0"><div id="tooltip" class="hidden" data-reactid=".0.0"><p data-reactid=".0.0.0"><span id="value" data-reactid=".0.0.0.0"></span></p></div><div id="topbar" class="" data-reactid=".0.1"><div class="tb-logo" data-reactid=".0.1.0"><a href="http://databricks.com/" target="_blank" rel="noopener noreferrer" title="Databricks" data-reactid=".0.1.0.0"><img src="./2. Introducción a Spark Streaming - Scala - Databricks_files/databricks_logoTM_rgb_TM.39f53bf0.svg" alt="databricks-logo" data-reactid=".0.1.0.0.0"></a></div><div class="tb-title-wrapper tb-title-wrapper-central" data-reactid=".0.1.1"><span data-reactid=".0.1.1.0"><span class="tb-title" data-reactid=".0.1.1.0.0">2. Introducción a Spark Streaming - Scala</span><span class="tb-title-lang" data-reactid=".0.1.1.0.1">(Scala)</span></span></div><div class="tb-import" data-reactid=".0.1.2"><a class="btn btn-default import-button" title="Import Notebook" data-reactid=".0.1.2.0"><i class="fa fa-cloud-upload" data-reactid=".0.1.2.0.0"></i><span data-reactid=".0.1.2.0.1"> Import Notebook</span></a></div></div><div id="overallView" class="" data-reactid=".0.2"><div id="content" data-reactid=".0.2.0"><div class="overallContainer" data-reactid=".0.2.0.0"><div class="shell-top new-notebook no-edit no-run static-notebook" data-reactid=".0.2.0.0.0"><img class="load-spinner" src="./2. Introducción a Spark Streaming - Scala - Databricks_files/spinner.7eb0071e.svg" data-reactid=".0.2.0.0.0.0"><div class="command divider" data-reactid=".0.2.0.0.0.1:$ac78a179-e7e4-4f1c-9e9a-68129c1cb70e-divider"><a class="btn btn-default btn-circle insert-command-btn" title="Insert a new cell" data-reactid=".0.2.0.0.0.1:$ac78a179-e7e4-4f1c-9e9a-68129c1cb70e-divider.0"><i class="fa fa-plus fa-fw" data-reactid=".0.2.0.0.0.1:$ac78a179-e7e4-4f1c-9e9a-68129c1cb70e-divider.0.0"></i></a><a class="btn btn-default btn-circle paste-command-btn hidden" title="Paste cell here" data-reactid=".0.2.0.0.0.1:$ac78a179-e7e4-4f1c-9e9a-68129c1cb70e-divider.1"><i class="fa fa-paste fa-fw" data-reactid=".0.2.0.0.0.1:$ac78a179-e7e4-4f1c-9e9a-68129c1cb70e-divider.1.0"></i></a></div><div class="new-notebook command mainCommand no-edit no-run command-finished cellIndex-0 cell-531573771711854-531573771711855" data-reactid=".0.2.0.0.0.1:$ac78a179-e7e4-4f1c-9e9a-68129c1cb70e"><div class="command-comments-wrapper" data-reactid=".0.2.0.0.0.1:$ac78a179-e7e4-4f1c-9e9a-68129c1cb70e.0"></div><a class="move-command-btn" draggable="true" data-reactid=".0.2.0.0.0.1:$ac78a179-e7e4-4f1c-9e9a-68129c1cb70e.1"><i class="fa fa-sort" data-reactid=".0.2.0.0.0.1:$ac78a179-e7e4-4f1c-9e9a-68129c1cb70e.1.0"></i></a><div class="command-input previousPrompt" data-reactid=".0.2.0.0.0.1:$ac78a179-e7e4-4f1c-9e9a-68129c1cb70e.4"><div class="command-text hidden command-text-finished" data-reactid=".0.2.0.0.0.1:$ac78a179-e7e4-4f1c-9e9a-68129c1cb70e.4.0"><div class="command-box wrappable" data-reactid=".0.2.0.0.0.1:$ac78a179-e7e4-4f1c-9e9a-68129c1cb70e.4.0.0"><pre class="cm-s-eclipse capture-run-mode" data-reactid=".0.2.0.0.0.1:$ac78a179-e7e4-4f1c-9e9a-68129c1cb70e.4.0.0.0">%md ## <span class="cm-strong">**</span><span class="cm-strong">Parseando</span><span class="cm-strong"> </span><span class="cm-strong">líneas</span><span class="cm-strong"> </span><span class="cm-strong">del</span><span class="cm-strong"> </span><span class="cm-strong">log</span><span class="cm-strong">**</span>

En este ejemplo se añade la capacidad de parsear líneas del log. Se muestra un ejemplo de procesamiento en el que se cuenta el número de bytes servidos por el Apache en cada microbatch.

NOTA: No debería fallar la ejecución pero si el notebook da errores de serialización al modificarlo conviene usar la opción "Detach &amp; Re-attach" en el cluster activo, es la opción que está accesible desde el menú de control de este notebook (arriba a la izquierda).
</pre></div></div></div><div class="results-and-comments" data-reactid=".0.2.0.0.0.1:$ac78a179-e7e4-4f1c-9e9a-68129c1cb70e.5"><div class="command-result-wrapper" data-reactid=".0.2.0.0.0.1:$ac78a179-e7e4-4f1c-9e9a-68129c1cb70e.5.0"><div class="command-result" data-reactid=".0.2.0.0.0.1:$ac78a179-e7e4-4f1c-9e9a-68129c1cb70e.5.0.0"><div class="results dashboard" data-reactid=".0.2.0.0.0.1:$ac78a179-e7e4-4f1c-9e9a-68129c1cb70e.5.0.0.4"><div class="dashboard"><div style="width: auto; position: relative; margin-top: 0px;"><div><div class="widget" data-guid="134d7cfc-9fcc-4e58-9840-a6cb2bcc218e" style="left: 0px; top: 0px; width: auto; height: auto;"><div class="widget-content dashboard"><div class="results"><div class="markdown"><h2><strong>Parseando líneas del log</strong></h2>
<p>En este ejemplo se añade la capacidad de parsear líneas del log. Se muestra un ejemplo de procesamiento en el que se cuenta el número de bytes servidos por el Apache en cada microbatch.</p>
<p>NOTA: No debería fallar la ejecución pero si el notebook da errores de serialización al modificarlo conviene usar la opción "Detach &amp; Re-attach" en el cluster activo, es la opción que está accesible desde el menú de control de este notebook (arriba a la izquierda).</p>
</div></div></div></div></div><!-- dashboardRefreshControlsTemplate -->
<div class="refresh-controls" style="position: absolute; left: 0px; top: 0px; display: none;">
  <hr>
  Last refresh: <span class="last-refresh">Never</span>
  <button class="btn btn-small refresh-now-button">Refresh now</button>
</div></div></div></div><noscript data-reactid=".0.2.0.0.0.1:$ac78a179-e7e4-4f1c-9e9a-68129c1cb70e.5.0.0.6"></noscript></div></div><div style="clear:both;" data-reactid=".0.2.0.0.0.1:$ac78a179-e7e4-4f1c-9e9a-68129c1cb70e.5.1"></div></div></div><div class="command divider" data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c-divider"><a class="btn btn-default btn-circle insert-command-btn" title="Insert a new cell" data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c-divider.0"><i class="fa fa-plus fa-fw" data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c-divider.0.0"></i></a><a class="btn btn-default btn-circle paste-command-btn hidden" title="Paste cell here" data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c-divider.1"><i class="fa fa-paste fa-fw" data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c-divider.1.0"></i></a></div><div class="new-notebook command mainCommand no-edit no-run command-finished cellIndex-1 cell-531573771711854-531573771711857" data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c"><div class="command-comments-wrapper" data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c.0"></div><a class="move-command-btn" draggable="true" data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c.1"><i class="fa fa-sort" data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c.1.0"></i></a><div class="command-input previousPrompt" data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c.4"><div class="command-text command-text-finished" data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c.4.0"><div class="command-box wrappable" data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c.4.0.0"><pre class="cm-s-eclipse capture-run-mode" data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c.4.0.0.0"><span class="cm-comment">// === Control de flujo de la aplicación ===</span>
<span class="cm-keyword">val</span> <span class="cm-def">stopActiveContext</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>     
<span class="cm-comment">// "true"  = parar los StreamingContext que ya se estén ejecutando (mejor dejarlo así);       </span>
<span class="cm-comment">// "false" = no parar y dejarlos seguir ejecutándose, pero puede ocurrir que los cambios que hagáis en el código no se ejecuten.</span>

<span class="cm-comment">// === Configuraciones para Spark Streaming ===</span>
<span class="cm-keyword">val</span> <span class="cm-def">batchIntervalSeconds</span> <span class="cm-operator">=</span> <span class="cm-number">1</span> 
<span class="cm-keyword">val</span> <span class="cm-def">eventsPerSecond</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>    <span class="cm-comment">// Para el generador en memoria de logs, cuántas líneas de log se generarán por segundo.</span>
</pre></div></div></div><div class="results-and-comments" data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c.5"><div class="command-result-wrapper" data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c.5.0"><div class="command-result" data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c.5.0.0"><noscript data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c.5.0.0.0"></noscript><noscript data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c.5.0.0.4"></noscript><noscript data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c.5.0.0.5"></noscript><noscript data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c.5.0.0.6"></noscript></div></div><div style="clear:both;" data-reactid=".0.2.0.0.0.1:$341dd64d-100b-454c-b339-02f927cfa92c.5.1"></div></div></div><div class="command divider" data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58-divider"><a class="btn btn-default btn-circle insert-command-btn" title="Insert a new cell" data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58-divider.0"><i class="fa fa-plus fa-fw" data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58-divider.0.0"></i></a><a class="btn btn-default btn-circle paste-command-btn hidden" title="Paste cell here" data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58-divider.1"><i class="fa fa-paste fa-fw" data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58-divider.1.0"></i></a></div><div class="new-notebook command mainCommand no-edit no-run command-finished cellIndex-2 cell-531573771711854-531573771711859" data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58"><div class="command-comments-wrapper" data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58.0"></div><a class="move-command-btn" draggable="true" data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58.1"><i class="fa fa-sort" data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58.1.0"></i></a><div class="command-input previousPrompt" data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58.4"><div class="command-text command-text-finished" data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58.4.0"><div class="command-box wrappable" data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58.4.0.0"><pre class="cm-s-eclipse capture-run-mode" data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58.4.0.0.0"><span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">apache</span>.<span class="cm-variable">spark</span>.<span class="cm-keyword">_</span>
<span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">apache</span>.<span class="cm-variable">spark</span>.<span class="cm-variable">storage</span>.<span class="cm-keyword">_</span>
<span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">apache</span>.<span class="cm-variable">spark</span>.<span class="cm-variable">streaming</span>.<span class="cm-keyword">_</span>

<span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">apache</span>.<span class="cm-variable">spark</span>.<span class="cm-variable">serializer</span>.{<span class="cm-variable">KryoSerializer</span>}
<span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">apache</span>.<span class="cm-variable">spark</span>.<span class="cm-variable">serializer</span>.{<span class="cm-variable">KryoSerializer</span>, <span class="cm-variable">KryoRegistrator</span>}

<span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">apache</span>.<span class="cm-variable">spark</span>.<span class="cm-variable">sql</span>.<span class="cm-keyword">_</span>
<span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">apache</span>.<span class="cm-variable">spark</span>.<span class="cm-variable">rdd</span>.<span class="cm-keyword">_</span>
</pre></div></div></div><div class="results-and-comments" data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58.5"><div class="command-result-wrapper" data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58.5.0"><div class="command-result" data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58.5.0.0"><noscript data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58.5.0.0.0"></noscript><noscript data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58.5.0.0.4"></noscript><noscript data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58.5.0.0.5"></noscript><noscript data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58.5.0.0.6"></noscript></div></div><div style="clear:both;" data-reactid=".0.2.0.0.0.1:$4eaa161f-5e16-495b-bab4-ae9851d7ee58.5.1"></div></div></div><div class="command divider" data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7-divider"><a class="btn btn-default btn-circle insert-command-btn" title="Insert a new cell" data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7-divider.0"><i class="fa fa-plus fa-fw" data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7-divider.0.0"></i></a><a class="btn btn-default btn-circle paste-command-btn hidden" title="Paste cell here" data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7-divider.1"><i class="fa fa-paste fa-fw" data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7-divider.1.0"></i></a></div><div class="new-notebook command mainCommand no-edit no-run command-finished cellIndex-3 cell-531573771711854-531573771711861" data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7"><div class="command-comments-wrapper" data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7.0"></div><a class="move-command-btn" draggable="true" data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7.1"><i class="fa fa-sort" data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7.1.0"></i></a><div class="command-input previousPrompt" data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7.4"><div class="command-text command-text-finished" data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7.4.0"><div class="command-box wrappable" data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7.4.0.0"><pre class="cm-s-eclipse capture-run-mode" data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7.4.0.0.0"><span class="cm-comment">// Este es un Receiver implementado ad hoc para tener una fuente de datos en stream. Se trata de un "generador aleatorio" de logs de acceso web.</span>
<span class="cm-comment">// No es relevante entender qué se está haciendo aquí. En el material lectivo comentaremos los Receivers.</span>

<span class="cm-keyword">import</span> <span class="cm-variable">scala</span>.<span class="cm-variable">util</span>.<span class="cm-variable">Random</span>
<span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">apache</span>.<span class="cm-variable">spark</span>.<span class="cm-variable">streaming</span>.<span class="cm-variable">receiver</span>.<span class="cm-keyword">_</span>

<span class="cm-keyword">class</span> <span class="cm-def">DummySource</span>(<span class="cm-variable">ratePerSec</span>: <span class="cm-type">Int</span>) <span class="cm-keyword">extends</span> <span class="cm-variable">Receiver</span>[<span class="cm-type">String</span>](<span class="cm-variable">StorageLevel</span>.<span class="cm-variable">MEMORY_AND_DISK_2</span>) {
  
  <span class="cm-keyword">val</span> <span class="cm-def">logs</span> <span class="cm-operator">=</span> <span class="cm-type">List</span>(
<span class="cm-string">"109.169.248.247 - - [12/Dec/2015:18:25:11 +0100] \"GET /administrator/ HTTP/1.1\" 200 4263 \"-\" \"Mozilla/5.0 (Windows NT 6.0; rv:34.0) Gecko/20100101 Firefox/34.0\" \"-\""</span>,
<span class="cm-string">"109.169.248.247 - - [12/Dec/2015:18:25:11 +0100] \"POST /administrator/index.php HTTP/1.1\" 200 4494 \"http://almhuette-raith.at/administrator/\" \"Mozilla/5.0 (Windows NT 6.0; rv:34.0) Gecko/20100101 Firefox/34.0\" \"-\""</span>,
<span class="cm-string">"188.45.108.168 - - [12/Dec/2015:19:44:06 +0100] \"GET / HTTP/1.1\" 200 10479 \"http://www.almenland.at/almhuetten-mit-naechtigung.html\" \"Mozilla/5.0 (Linux; Android 4.4.2; de-at; SAMSUNG GT-I9301I Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/1.5 Chrome/28.0.1500.94 Mobile Safari/537.36\" \"-\""</span>,
<span class="cm-string">"188.45.108.168 - - [12/Dec/2015:19:44:06 +0100] \"GET /modules/mod_bowslideshow/tmpl/css/bowslideshow.css HTTP/1.1\" 200 1725 \"http://www.almhuette-raith.at/\" \"Mozilla/5.0 (Linux; Android 4.4.2; de-at; SAMSUNG GT-I9301I Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/1.5 Chrome/28.0.1500.94 Mobile Safari/537.36\" \"-\""</span>,
<span class="cm-string">"188.45.108.168 - - [12/Dec/2015:19:44:06 +0100] \"GET /templates/_system/css/general.css HTTP/1.1\" 404 239 \"http://www.almhuette-raith.at/\" \"Mozilla/5.0 (Linux; Android 4.4.2; de-at; SAMSUNG GT-I9301I Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/1.5 Chrome/28.0.1500.94 Mobile Safari/537.36\" \"-\""</span>,
<span class="cm-string">"188.45.108.168 - - [12/Dec/2015:19:44:07 +0100] \"GET /templates/jp_hotel/css/template.css HTTP/1.1\" 200 10004 \"http://www.almhuette-raith.at/\" \"Mozilla/5.0 (Linux; Android 4.4.2; de-at; SAMSUNG GT-I9301I Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/1.5 Chrome/28.0.1500.94 Mobile Safari/537.36\" \"-\""</span>,
<span class="cm-string">"188.45.108.168 - - [12/Dec/2015:19:44:07 +0100] \"GET /templates/jp_hotel/css/layout.css HTTP/1.1\" 200 1801 \"http://www.almhuette-raith.at/\" \"Mozilla/5.0 (Linux; Android 4.4.2; de-at; SAMSUNG GT-I9301I Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/1.5 Chrome/28.0.1500.94 Mobile Safari/537.36\" \"-\""</span>,
<span class="cm-string">"188.45.108.168 - - [12/Dec/2015:19:44:07 +0100] \"GET /templates/jp_hotel/css/menu.css HTTP/1.1\" 200 1457 \"http://www.almhuette-raith.at/\" \"Mozilla/5.0 (Linux; Android 4.4.2; de-at; SAMSUNG GT-I9301I Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/1.5 Chrome/28.0.1500.94 Mobile Safari/537.36\" \"-\""</span>,
<span class="cm-string">"188.45.108.168 - - [12/Dec/2015:19:44:07 +0100] \"GET /templates/jp_hotel/css/suckerfish.css HTTP/1.1\" 200 3465 \"http://www.almhuette-raith.at/\" \"Mozilla/5.0 (Linux; Android 4.4.2; de-at; SAMSUNG GT-I9301I Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/1.5 Chrome/28.0.1500.94 Mobile Safari/537.36\" \"-\""</span>,
<span class="cm-string">"188.45.108.168 - - [12/Dec/2015:19:44:08 +0100] \"GET /media/system/js/caption.js HTTP/1.1\" 200 1963 \"http://www.almhuette-raith.at/\" \"Mozilla/5.0 (Linux; Android 4.4.2; de-at; SAMSUNG GT-I9301I Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/1.5 Chrome/28.0.1500.94 Mobile Safari/537.36\" \"-\""</span>,
<span class="cm-string">"66.249.69.97 - - [12/Dec/2015:19:44:08 +0100] \"GET /071300/242153 HTTP/1.1\" 404 514 \"-\" \"Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\" \"-\""</span>,
<span class="cm-string">"188.45.108.168 - - [12/Dec/2015:19:44:09 +0100] \"GET /nf HTTP/1.1\" 404 505 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2062.94 Safari/537.36\" \"-\""</span>,
<span class="cm-string">"188.45.108.168 - - [12/Dec/2015:19:44:09 +0100] \"GET /plain.php HTTP/1.1\" 500 505 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2062.94 Safari/537.36\" \"-\""</span>)

  <span class="cm-keyword">def</span> <span class="cm-def">onStart</span>() {
    <span class="cm-keyword">new</span> <span class="cm-type">Thread</span>(<span class="cm-string">"Logs Dummy Source"</span>) {
      <span class="cm-keyword">override</span> <span class="cm-keyword">def</span> <span class="cm-def">run</span>() { <span class="cm-variable">receive</span>() }
    }.<span class="cm-variable">start</span>()
  }

  <span class="cm-keyword">def</span> <span class="cm-def">onStop</span>() {
  }

  <span class="cm-keyword">private</span> <span class="cm-keyword">def</span> <span class="cm-def">receive</span>() {
    <span class="cm-keyword">while</span>(<span class="cm-operator">!</span><span class="cm-variable">isStopped</span>()) {      
      <span class="cm-variable">store</span>(<span class="cm-variable">logs</span>(<span class="cm-variable">Random</span>.<span class="cm-variable">nextInt</span>(<span class="cm-variable">logs</span>.<span class="cm-variable">size</span>)))
      <span class="cm-type">Thread</span>.<span class="cm-variable">sleep</span>((<span class="cm-number">1000.</span><span class="cm-variable">toDouble</span> <span class="cm-operator">/</span> <span class="cm-variable">ratePerSec</span>).<span class="cm-variable">toInt</span>)
    }
  }
}


<span class="cm-keyword">case</span> <span class="cm-keyword">class</span> <span class="cm-def">LogRecord</span>( <span class="cm-variable">clientIp</span>: <span class="cm-type">String</span>, <span class="cm-variable">clientIdentity</span>: <span class="cm-type">String</span>, <span class="cm-variable">user</span>: <span class="cm-type">String</span>, <span class="cm-variable">dateTime</span>: <span class="cm-type">String</span>, <span class="cm-variable">request</span>:<span class="cm-type">String</span>,<span class="cm-variable">statusCode</span>:<span class="cm-type">Int</span>, <span class="cm-variable">bytesSent</span>:<span class="cm-type">Long</span>, <span class="cm-variable">referer</span>:<span class="cm-type">String</span>, <span class="cm-variable">userAgent</span>:<span class="cm-type">String</span> )
 
<span class="cm-keyword">object</span> <span class="cm-def">Logs</span> {
    <span class="cm-keyword">val</span> <span class="cm-def">PATTERN</span> <span class="cm-operator">=</span> <span class="cm-string">"""^(\S+) (\S+) (\S+) \[([\w:/]+\s[+\-]\d{4})\] "(\S+) (\S+) (\S+)" (\d{3}) (\S+) "(\S+)" "([^"]*)"""</span><span class="cm-string">".r</span>
 
    <span class="cm-string">def parseLogLine(log: String): LogRecord = {</span>
      <span class="cm-string">try {</span>
        <span class="cm-string">val res = PATTERN.findFirstMatchIn(log)</span>
 
        <span class="cm-string">if (res.isEmpty) {</span>
          <span class="cm-string">println("</span><span class="cm-variable">Rejected</span> <span class="cm-variable">Log</span> <span class="cm-variable">Line</span>: <span class="cm-string">" + log)</span>
          <span class="cm-string">LogRecord("</span><span class="cm-variable">Empty</span><span class="cm-string">", "</span><span class="cm-operator">-</span><span class="cm-string">", "</span><span class="cm-operator">-</span><span class="cm-string">", "</span><span class="cm-string">", "</span><span class="cm-string">",  -1, -1, "</span><span class="cm-operator">-</span><span class="cm-string">", "</span><span class="cm-operator">-</span><span class="cm-string">" )</span>
        <span class="cm-string">}</span>
        <span class="cm-string">else {</span>
          <span class="cm-string">val m = res.get</span>
          <span class="cm-string">// NOTE:   HEAD does not have a content size.</span>
          <span class="cm-string">if (m.group(9).equals("</span><span class="cm-operator">-</span><span class="cm-string">")) {</span>
            <span class="cm-string">LogRecord(m.group(1), m.group(2), m.group(3), m.group(4),</span>
              <span class="cm-string">m.group(5), m.group(8).toInt, 0, m.group(10), m.group(11))</span>
          <span class="cm-string">}</span>
          <span class="cm-string">else {</span>
            <span class="cm-string">LogRecord(m.group(1), m.group(2), m.group(3), m.group(4),</span>
              <span class="cm-string">m.group(5), m.group(8).toInt, m.group(9).toLong, m.group(10), m.group(11))</span>
          <span class="cm-string">}</span>
        <span class="cm-string">}</span>
      <span class="cm-string">} catch {</span>
        <span class="cm-string">case e: Exception =&gt;</span>
          <span class="cm-string">println("</span><span class="cm-type">Exception</span> <span class="cm-variable">on</span> <span class="cm-variable">line</span>:<span class="cm-string">" + log + "</span>:<span class="cm-string">" + e.getMessage);</span>
          <span class="cm-string">LogRecord("</span><span class="cm-variable">Empty</span><span class="cm-string">", "</span><span class="cm-operator">-</span><span class="cm-string">", "</span><span class="cm-operator">-</span><span class="cm-string">", "</span><span class="cm-string">", "</span><span class="cm-operator">-</span><span class="cm-string">", -1, -1, "</span><span class="cm-operator">-</span><span class="cm-string">", "</span><span class="cm-operator">-</span><span class="cm-string">" )</span>
      <span class="cm-string">}</span>
    <span class="cm-string">}</span>
 <span class="cm-string">}  </span>

</pre></div></div></div><div class="results-and-comments" data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7.5"><div class="command-result-wrapper" data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7.5.0"><div class="command-result" data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7.5.0.0"><noscript data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7.5.0.0.0"></noscript><noscript data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7.5.0.0.4"></noscript><noscript data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7.5.0.0.5"></noscript><noscript data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7.5.0.0.6"></noscript></div></div><div style="clear:both;" data-reactid=".0.2.0.0.0.1:$cce8c265-80d1-47c2-812c-fddbe93eb6d7.5.1"></div></div></div><div class="command divider" data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd-divider"><a class="btn btn-default btn-circle insert-command-btn" title="Insert a new cell" data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd-divider.0"><i class="fa fa-plus fa-fw" data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd-divider.0.0"></i></a><a class="btn btn-default btn-circle paste-command-btn hidden" title="Paste cell here" data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd-divider.1"><i class="fa fa-paste fa-fw" data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd-divider.1.0"></i></a></div><div class="new-notebook command mainCommand no-edit no-run command-finished cellIndex-4 cell-531573771711854-531573771711862" data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd"><div class="command-comments-wrapper" data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd.0"></div><a class="move-command-btn" draggable="true" data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd.1"><i class="fa fa-sort" data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd.1.0"></i></a><div class="command-input previousPrompt" data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd.4"><div class="command-text command-text-finished" data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd.4.0"><div class="command-box wrappable" data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd.4.0.0"><pre class="cm-s-eclipse capture-run-mode" data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd.4.0.0.0"><span class="cm-keyword">var</span> <span class="cm-def">newContextCreated</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>      <span class="cm-comment">// Flag para detectar si se ha creado un nuevo contexto o no</span>

<span class="cm-comment">// Función de creación y configuración de un nuevo StreamingContext</span>
<span class="cm-keyword">def</span> <span class="cm-def">creatingFunc</span>(): <span class="cm-variable">StreamingContext</span> <span class="cm-operator">=</span> {
  
  <span class="cm-keyword">val</span> <span class="cm-def">ssc</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">StreamingContext</span>(<span class="cm-variable">sc</span>, <span class="cm-variable">Seconds</span>(<span class="cm-variable">batchIntervalSeconds</span>))
  <span class="cm-keyword">val</span> <span class="cm-def">lines</span> <span class="cm-operator">=</span> <span class="cm-variable">ssc</span>.<span class="cm-variable">receiverStream</span>(<span class="cm-keyword">new</span> <span class="cm-variable">DummySource</span>(<span class="cm-variable">eventsPerSecond</span>))
  <span class="cm-keyword">val</span> <span class="cm-def">accessLogs</span> <span class="cm-operator">=</span> <span class="cm-variable">lines</span>.<span class="cm-variable">map</span>(<span class="cm-variable">Logs</span>.<span class="cm-variable">parseLogLine</span>)

  <span class="cm-keyword">val</span> <span class="cm-def">contentSizes</span> <span class="cm-operator">=</span> <span class="cm-variable">accessLogs</span>.<span class="cm-variable">map</span>(<span class="cm-variable">log</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">log</span>.<span class="cm-variable">bytesSent</span>)
  <span class="cm-keyword">val</span> <span class="cm-def">contentTotal</span> <span class="cm-operator">=</span> <span class="cm-variable">contentSizes</span>.<span class="cm-variable">reduce</span>(<span class="cm-keyword">_</span> <span class="cm-operator">+</span> <span class="cm-keyword">_</span>)
 
  <span class="cm-variable">contentTotal</span>.<span class="cm-keyword">print</span>() <span class="cm-comment">// Contenido total en bytes servido por el Apache</span>
  
  <span class="cm-keyword">println</span>(<span class="cm-string">"Se ha invocado la función para crear un nuevo StreamingContext"</span>)
  <span class="cm-variable">newContextCreated</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>  
  <span class="cm-variable">ssc</span>
}
</pre></div></div></div><div class="results-and-comments" data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd.5"><div class="command-result-wrapper" data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd.5.0"><div class="command-result" data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd.5.0.0"><noscript data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd.5.0.0.0"></noscript><noscript data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd.5.0.0.4"></noscript><noscript data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd.5.0.0.5"></noscript><noscript data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd.5.0.0.6"></noscript></div></div><div style="clear:both;" data-reactid=".0.2.0.0.0.1:$c0c36d9b-3ea8-4a66-ab1a-075d17f218cd.5.1"></div></div></div><div class="command divider" data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45-divider"><a class="btn btn-default btn-circle insert-command-btn" title="Insert a new cell" data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45-divider.0"><i class="fa fa-plus fa-fw" data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45-divider.0.0"></i></a><a class="btn btn-default btn-circle paste-command-btn hidden" title="Paste cell here" data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45-divider.1"><i class="fa fa-paste fa-fw" data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45-divider.1.0"></i></a></div><div class="new-notebook command mainCommand no-edit no-run command-finished cellIndex-5 cell-531573771711854-531573771711864" data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45"><div class="command-comments-wrapper" data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45.0"></div><a class="move-command-btn" draggable="true" data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45.1"><i class="fa fa-sort" data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45.1.0"></i></a><div class="command-input previousPrompt" data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45.4"><div class="command-text command-text-finished" data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45.4.0"><div class="command-box wrappable" data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45.4.0.0"><pre class="cm-s-eclipse capture-run-mode" data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45.4.0.0.0"><span class="cm-keyword">if</span> (<span class="cm-variable">stopActiveContext</span>) {
  <span class="cm-comment">// Paramos cualquier StreamingContext activo </span>
  <span class="cm-variable">StreamingContext</span>.<span class="cm-variable">getActive</span>.<span class="cm-variable">foreach</span> { <span class="cm-keyword">_</span>.<span class="cm-variable">stop</span>(<span class="cm-variable">stopSparkContext</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>) }
} 

<span class="cm-comment">// Obtenemos o creamos el StreamingContext con el que trabajar</span>
<span class="cm-keyword">val</span> <span class="cm-def">ssc</span> <span class="cm-operator">=</span> <span class="cm-variable">StreamingContext</span>.<span class="cm-variable">getActiveOrCreate</span>(<span class="cm-variable">creatingFunc</span>)
<span class="cm-keyword">if</span> (<span class="cm-variable">newContextCreated</span>) {
  <span class="cm-keyword">println</span>(<span class="cm-string">"Nuevo contexto creado desde la función creatingFunc"</span>) 
} <span class="cm-keyword">else</span> {
  <span class="cm-keyword">println</span>(<span class="cm-string">"Hay un contexto ejecutándose o se ha recuperado de un checkpoint"</span>)
}

<span class="cm-variable">ssc</span>.<span class="cm-variable">start</span>()
<span class="cm-variable">ssc</span>.<span class="cm-variable">awaitTerminationOrTimeout</span>(<span class="cm-variable">batchIntervalSeconds</span> <span class="cm-operator">*</span> <span class="cm-number">20</span> <span class="cm-operator">*</span> <span class="cm-number">1000</span>) <span class="cm-comment">// Esto pondrá esta celda del notebook en espera durante 20 veces el batchIntervalSeconds.</span>

</pre></div></div></div><div class="results-and-comments" data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45.5"><div class="command-result-wrapper" data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45.5.0"><div class="command-result" data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45.5.0.0"><noscript data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45.5.0.0.0"></noscript><noscript data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45.5.0.0.4"></noscript><noscript data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45.5.0.0.5"></noscript><noscript data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45.5.0.0.6"></noscript></div></div><div style="clear:both;" data-reactid=".0.2.0.0.0.1:$b14e311b-2f14-45c6-8a81-b2026da8ee45.5.1"></div></div></div><div class="command divider" data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df-divider"><a class="btn btn-default btn-circle insert-command-btn" title="Insert a new cell" data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df-divider.0"><i class="fa fa-plus fa-fw" data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df-divider.0.0"></i></a><a class="btn btn-default btn-circle paste-command-btn hidden" title="Paste cell here" data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df-divider.1"><i class="fa fa-paste fa-fw" data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df-divider.1.0"></i></a></div><div class="new-notebook command mainCommand no-edit no-run command-finished cellIndex-6 cell-531573771711854-531573771711867" data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df"><div class="command-comments-wrapper" data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df.0"></div><a class="move-command-btn" draggable="true" data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df.1"><i class="fa fa-sort" data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df.1.0"></i></a><div class="command-input previousPrompt primaryPrompt" data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df.4"><div class="command-text command-text-finished" data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df.4.0"><div class="command-box wrappable" data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df.4.0.0"><pre class="cm-s-eclipse capture-run-mode" data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df.4.0.0.0"><span class="cm-comment">//StreamingContext.getActive.foreach { _.stop(stopSparkContext = false) }</span>
</pre></div></div></div><div class="results-and-comments" data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df.5"><div class="command-result-wrapper" data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df.5.0"><div class="command-result" data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df.5.0.0"><noscript data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df.5.0.0.0"></noscript><noscript data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df.5.0.0.4"></noscript><noscript data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df.5.0.0.5"></noscript><noscript data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df.5.0.0.6"></noscript></div></div><div style="clear:both;" data-reactid=".0.2.0.0.0.1:$059ece16-b714-4b15-982d-1654ca97f9df.5.1"></div></div></div><div class="command divider" data-reactid=".0.2.0.0.0.$last-command-divider"><a class="btn btn-default btn-circle insert-command-btn" title="Insert a new cell" data-reactid=".0.2.0.0.0.$last-command-divider.0"><i class="fa fa-plus fa-fw" data-reactid=".0.2.0.0.0.$last-command-divider.0.0"></i></a><a class="btn btn-default btn-circle paste-command-btn hidden" title="Paste cell here" data-reactid=".0.2.0.0.0.$last-command-divider.1"><i class="fa fa-paste fa-fw" data-reactid=".0.2.0.0.0.$last-command-divider.1.0"></i></a></div><div class="contentSpacer" style="height:0px;" data-reactid=".0.2.0.0.0.4"></div></div></div></div></div></div></body></html>